/*! For license information please see server-compiled.js.LICENSE.txt */
(()=>{var e={427:(e,t,s)=>{s(185).connect(process.env.MONGODB_URL)},294:e=>{e.exports=(e,t,s,r)=>{console.error(e),s.status(500).send(e)}},954:(e,t,s)=>{const r=s(738),n=r.diskStorage({}),i=r({storage:n,fileFilter:(e,t,s)=>{"image/jpeg"===t.mimetype||"image/png"===t.mimetype?s(null,!0):s({message:"Invalid file type."},!1)}});e.exports=i},998:(e,t,s)=>{const r=s(185),n=new r.Schema({imageUrl:String,publicId:String},{timestamps:!0}),i=r.model("Image",n);e.exports={Image:i,imageSchema:n}},3:(e,t,s)=>{const r=s(185),{imageSchema:n}=s(998),i=new r.Schema({title:{type:String,default:"Untitled"},subtitle:String,content:String,images:[n],postTags:[]},{timestamps:!0}),o=r.model("Post",i);e.exports=o},945:(e,t,s)=>{const r=s(185),n=s(671),i=s(212),o=new r.Schema({username:String,password:String},{timestamps:!0});o.plugin(n);const a=r.model("User",o);i.use(a.createStrategy()),i.serializeUser(a.serializeUser()),i.deserializeUser(a.deserializeUser()),e.exports=a},119:(e,t,s)=>{const r=s(860),n=s(212),i=new r.Router;i.get("/login",((e,t)=>{t.render("login")})),i.post("/login",n.authenticate("local",{successRedirect:"/admin/dashboard",failureRedirect:"/login"})),i.get("/logout",((e,t,s)=>{e.session.user=null,e.session.save((r=>{r&&s(r),e.session.regenerate((e=>{e&&s(e),t.redirect("/")}))}))})),i.get("/admin/dashboard",((e,t)=>{t.set("Cache-Control","no-cache, private, no-store, must-revalidate, max-stal e=0, post-check=0, pre-check=0"),e.isAuthenticated()?t.render("dashboard"):t.redirect("/login")})),e.exports=i},762:(e,t,s)=>{const r=s(860),n=s(954),i=s(3),{Image:o}=s(998),{uploadToCloudinary:a,removeFromCloudinary:u}=s(463),c=new r.Router;s(738),n.array("postImages",5),c.get("/",(async(e,t)=>{t.redirect("posts")})),c.get("/posts",(async(e,t)=>{try{const e=await i.find();t.render("posts",{posts:e})}catch(e){t.status(400).send(e)}})),c.post("/posts",n.array("postImages",20),(async(e,t)=>{try{const s=new i(e.body,{setDefaultsOnInsert:!0}),r=await s.save(),n=e.files;await Promise.all(n.map((async e=>{const t=await a(e.path,"emaJons_dev"),s=new o({publicId:t.public_id,imageUrl:t.url});await i.updateOne({_id:r._id},{$addToSet:{images:[s]}})}))),t.redirect("/posts")}catch(e){t.status(400).send(e)}})),e.exports=c},532:(e,t,s)=>{const r=s(119),n=s(762);e.exports={authRouter:r,postRouter:n}},463:(e,t,s)=>{const r=s(518);s(142).config(),r.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET}),e.exports={uploadToCloudinary:(e,t)=>r.v2.uploader.upload(e,{folder:t}).then((e=>({url:e.url,public_id:e.public_id}))).catch((e=>{console.log(e)})),removeFromCloudinary:async e=>{await r.v2.uploader.destroy(e,((e,t)=>{console.log(e,t)}))}}},24:(e,t,s)=>{"use strict";var r=s(400).Buffer,n=s(802),i=s(113),o=s(974)("express-session"),a=s(352)("express-session"),u=s(236),c=s(215),l=s(553),f=s(599).sync,p=s(146),h=s(101),d=s(651),g=s(953);(t=e.exports=function(e){var t=e||{},s=t.cookie||{},i=t.genid||y,f=t.name||t.key||"connect.sid",g=t.store||new h,E=t.proxy,k=t.resave,b=Boolean(t.rolling),S=t.saveUninitialized,_=t.secret;if("function"!=typeof i)throw new TypeError("genid option must be a function");if(void 0===k&&(a("undefined resave option; provide resave option"),k=!0),void 0===S&&(a("undefined saveUninitialized option; provide saveUninitialized option"),S=!0),t.unset&&"destroy"!==t.unset&&"keep"!==t.unset)throw new TypeError('unset option must be "destroy" or "keep"');var A="destroy"===t.unset;if(Array.isArray(_)&&0===_.length)throw new TypeError("secret option array must contain one or more strings");_&&!Array.isArray(_)&&(_=[_]),_||a("req.secret; provide secret option"),g instanceof h&&console.warn("Warning: connect.session() MemoryStore is not\ndesigned for a production environment, as it will leak\nmemory, and will not scale past a single process."),g.generate=function(e){e.sessionID=i(e),e.session=new d(e),e.session.cookie=new p(s),"auto"===s.secure&&(e.session.cookie.secure=w(e,E))};var I="function"==typeof g.touch,M=!0;return g.on("disconnect",(function(){M=!1})),g.on("connect",(function(){M=!0})),function(e,t,i){if(e.session)i();else{if(!M)return o("store is disconnected"),void i();if(0!==(c.original(e).pathname||"/").indexOf(s.path||"/"))return i();if(_||e.secret){var p,h,d,y=_||[e.secret],F=!1;e.sessionStore=g;var U=e.sessionID=function(e,t,s){var r,i,u=e.headers.cookie;return u&&(r=n.parse(u)[t])&&("s:"===r.substr(0,2)?!1===(i=x(r.slice(2),s))&&(o("cookie signature invalid"),i=void 0):o("cookie unsigned")),!i&&e.signedCookies&&(i=e.signedCookies[t])&&a("cookie should be available in req.headers.cookie"),!i&&e.cookies&&(r=e.cookies[t])&&("s:"===r.substr(0,2)?((i=x(r.slice(2),s))&&a("cookie should be available in req.headers.cookie"),!1===i&&(o("cookie signature invalid"),i=void 0)):o("cookie unsigned")),i}(e,f,y);u(t,(function(){e.session?function(e){return"string"==typeof e.sessionID&&(U!==e.sessionID?S||C(e.session):b||null!=e.session.cookie.expires&&C(e.session))}(e)&&(!e.session.cookie.secure||w(e,E)?(F||(e.session.touch(),F=!0),function(e,t,s,r,i){var a="s:"+l.sign(s,r),u=n.serialize(t,a,i);o("set-cookie %s",u);var c=e.getHeader("Set-Cookie")||[],f=Array.isArray(c)?c.concat(u):[c,u];e.setHeader("Set-Cookie",f)}(t,f,e.sessionID,y[0],e.session.cookie.data)):o("not secured")):o("no session")}));var P=t.end,T=t.write,D=!1;if(t.end=function(s,n){if(D)return!1;var a;D=!0;var u=!0;function c(){if(u)return a=P.call(t,s,n),void(u=!1);P.call(t)}function l(){if(!u)return a;if(t._header||t._implicitHeader(),null==s)return a=!0;var e=Number(t.getHeader("Content-Length"));return!isNaN(e)&&e>0&&(s=r.isBuffer(s)?s:r.from(s,n),n=void 0,0!==s.length)?(o("split response"),a=T.call(t,s.slice(0,s.length-1)),s=s.slice(s.length-1,s.length),a):(a=T.call(t,s,n),u=!1,a)}return function(e){return e.sessionID&&A&&null==e.session}(e)?(o("destroying"),g.destroy(e.sessionID,(function(e){e&&m(i,e),o("destroyed"),c()})),l()):e.session?(F||(e.session.touch(),F=!0),z(e)?(e.session.save((function(e){e&&m(i,e),c()})),l()):I&&function(e){return"string"!=typeof e.sessionID?(o("session ignored because of bogus req.sessionID %o",e.sessionID),!1):U===e.sessionID&&!z(e)}(e)?(o("touching"),g.touch(e.sessionID,e.session,(function(e){e&&m(i,e),o("touched"),c()})),l()):P.call(t,s,n)):(o("no session"),P.call(t,s,n))},!e.sessionID)return o("no SID sent, generating session"),q(),void i();o("fetching %s",e.sessionID),g.get(e.sessionID,(function(t,s){if(t&&"ENOENT"!==t.code)return o("error %j",t),void i(t);try{t||!s?(o("no session found"),q()):(o("session found"),function(e,t){g.createSession(e,t),h=e.sessionID,p=v(t),k||(d=p),O(e.session)}(e,s))}catch(e){return void i(e)}i()}))}else i(new Error("secret option required for sessions"))}function q(){g.generate(e),h=e.sessionID,p=v(e.session),O(e.session)}function O(t){var s=t.reload,r=t.save;Object.defineProperty(t,"reload",{configurable:!0,enumerable:!1,value:function(t){o("reloading %s",this.id),s.call(this,function(t,s){return function(){e.session!==t&&O(e.session),s.apply(this,arguments)}}(this,t))},writable:!0}),Object.defineProperty(t,"save",{configurable:!0,enumerable:!1,value:function(){o("saving %s",this.id),d=v(this),r.apply(this,arguments)},writable:!0})}function C(e){return h!==e.id||p!==v(e)}function z(e){return"string"!=typeof e.sessionID?(o("session ignored because of bogus req.sessionID %o",e.sessionID),!1):S||d||U===e.sessionID?(t=e.session,!(h===t.id&&d===v(t))):C(e.session);var t}}}).Store=g,t.Cookie=p,t.Session=d,t.MemoryStore=h;var m="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};function y(e){return f(24)}function v(e){var t=JSON.stringify(e,(function(t,s){if(this!==e||"cookie"!==t)return s}));return i.createHash("sha1").update(t,"utf8").digest("hex")}function w(e,t){if(e.connection&&e.connection.encrypted)return!0;if(!1===t)return!1;if(!0!==t)return!0===e.secure;var s=e.headers["x-forwarded-proto"]||"",r=s.indexOf(",");return"https"===(-1!==r?s.substr(0,r).toLowerCase().trim():s.toLowerCase().trim())}function x(e,t){for(var s=0;s<t.length;s++){var r=l.unsign(e,t[s]);if(!1!==r)return r}return!1}},146:(e,t,s)=>{"use strict";var r=s(802),n=s(352)("express-session");(e.exports=function(e){if(this.path="/",this.maxAge=null,this.httpOnly=!0,e){if("object"!=typeof e)throw new TypeError("argument options must be a object");for(var t in e)"data"!==t&&(this[t]=e[t])}void 0!==this.originalMaxAge&&null!==this.originalMaxAge||(this.originalMaxAge=this.maxAge)}).prototype={set expires(e){this._expires=e,this.originalMaxAge=this.maxAge},get expires(){return this._expires},set maxAge(e){if(e&&"number"!=typeof e&&!(e instanceof Date))throw new TypeError("maxAge must be a number or Date");e instanceof Date&&n("maxAge as Date; pass number of milliseconds instead"),this.expires="number"==typeof e?new Date(Date.now()+e):e},get maxAge(){return this.expires instanceof Date?this.expires.valueOf()-Date.now():this.expires},get data(){return{originalMaxAge:this.originalMaxAge,expires:this._expires,secure:this.secure,httpOnly:this.httpOnly,domain:this.domain,path:this.path,sameSite:this.sameSite}},serialize:function(e,t){return r.serialize(e,t,this.data)},toJSON:function(){return this.data}}},101:(e,t,s)=>{"use strict";var r=s(953),n=s(837),i="function"==typeof setImmediate?setImmediate:function(e){process.nextTick(e.bind.apply(e,arguments))};function o(){r.call(this),this.sessions=Object.create(null)}function a(e){var t=this.sessions[e];if(t){if((t=JSON.parse(t)).cookie){var s="string"==typeof t.cookie.expires?new Date(t.cookie.expires):t.cookie.expires;if(s&&s<=Date.now())return void delete this.sessions[e]}return t}}e.exports=o,n.inherits(o,r),o.prototype.all=function(e){for(var t=Object.keys(this.sessions),s=Object.create(null),r=0;r<t.length;r++){var n=t[r],o=a.call(this,n);o&&(s[n]=o)}e&&i(e,null,s)},o.prototype.clear=function(e){this.sessions=Object.create(null),e&&i(e)},o.prototype.destroy=function(e,t){delete this.sessions[e],t&&i(t)},o.prototype.get=function(e,t){i(t,null,a.call(this,e))},o.prototype.set=function(e,t,s){this.sessions[e]=JSON.stringify(t),s&&i(s)},o.prototype.length=function(e){this.all((function(t,s){if(t)return e(t);e(null,Object.keys(s).length)}))},o.prototype.touch=function(e,t,s){var r=a.call(this,e);r&&(r.cookie=t.cookie,this.sessions[e]=JSON.stringify(r)),s&&i(s)}},651:e=>{"use strict";function t(e,t){if(Object.defineProperty(this,"req",{value:e}),Object.defineProperty(this,"id",{value:e.sessionID}),"object"==typeof t&&null!==t)for(var s in t)s in this||(this[s]=t[s])}function s(e,t,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:s,writable:!0})}e.exports=t,s(t.prototype,"touch",(function(){return this.resetMaxAge()})),s(t.prototype,"resetMaxAge",(function(){return this.cookie.maxAge=this.cookie.originalMaxAge,this})),s(t.prototype,"save",(function(e){return this.req.sessionStore.set(this.id,this,e||function(){}),this})),s(t.prototype,"reload",(function(e){var t=this.req,s=this.req.sessionStore;return s.get(this.id,(function(r,n){return r?e(r):n?(s.createSession(t,n),void e()):e(new Error("failed to load session"))})),this})),s(t.prototype,"destroy",(function(e){return delete this.req.session,this.req.sessionStore.destroy(this.id,e),this})),s(t.prototype,"regenerate",(function(e){return this.req.sessionStore.regenerate(this.req,e),this}))},953:(e,t,s)=>{"use strict";var r=s(146),n=s(239).EventEmitter,i=s(651),o=s(837);function a(){n.call(this)}e.exports=a,o.inherits(a,n),a.prototype.regenerate=function(e,t){var s=this;this.destroy(e.sessionID,(function(r){s.generate(e),t(r)}))},a.prototype.load=function(e,t){var s=this;this.get(e,(function(r,n){if(r)return t(r);if(!n)return t();var i={sessionID:e,sessionStore:s};t(null,s.createSession(i,n))}))},a.prototype.createSession=function(e,t){var s=t.cookie.expires,n=t.cookie.originalMaxAge;return t.cookie=new r(t.cookie),"string"==typeof s&&(t.cookie.expires=new Date(s)),t.cookie.originalMaxAge=n,e.session=new i(e,t),e.session}},791:(e,t,s)=>{var r=s(837);function n(e,t){if(e)for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t}e.exports=function(e,t,s){(s=s||{}).captureStackTrace=void 0===s.captureStackTrace,s.inherits=s.inherits||Error;var i=function(){if(!(this instanceof i)){var o=Array.prototype.slice.call(arguments);return o.unshift(i),new(i.bind.apply(i,o))}s.inherits.call(this),s.captureStackTrace&&Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee),n(t,this);var a=arguments[0];if(a){var u=Array.prototype.slice.call(arguments);if(u.length>1&&"object"==typeof u[u.length-1]){var c=u.pop();n(c,this)}this.message=r.format.apply(r,u)}this.name=e};return r.inherits(i,s.inherits),i}},236:e=>{"use strict";function t(e,t){for(var s=0;s<t.length;s++)e.setHeader(t[s][0],t[s][1])}function s(e,t){for(var s=Object.keys(t),r=0;r<s.length;r++){var n=s[r];n&&e.setHeader(n,t[n])}}function r(e){var r=arguments.length,n=r>1&&"string"==typeof arguments[1]?2:1,i=r>=n+1?arguments[n]:void 0;this.statusCode=e,Array.isArray(i)?t(this,i):i&&s(this,i);for(var o=new Array(Math.min(r,n)),a=0;a<o.length;a++)o[a]=arguments[a];return o}e.exports=function(e,t){if(!e)throw new TypeError("argument res is required");if("function"!=typeof t)throw new TypeError("argument listener must be a function");e.writeHead=function(e,t){var s=!1;return function(n){var i=r.apply(this,arguments);return s||(s=!0,t.call(this),"number"==typeof i[0]&&this.statusCode!==i[0]&&(i[0]=this.statusCode,i.length=1)),e.apply(this,i)}}(e.writeHead,t)}},671:(e,t,s)=>{const r=s(113),n=s(462).Strategy,i=s(456),o=s(77),a=s(355);e.exports=function(e,t){(t=t||{}).saltlen=t.saltlen||32,t.iterations=t.iterations||25e3,t.keylen=t.keylen||512,t.encoding=t.encoding||"hex",t.digestAlgorithm=t.digestAlgorithm||"sha256",t.passwordValidator=t.passwordValidator||function(e,t){t(null)},t.passwordValidatorAsync=t.passwordValidatorAsync||function(e){return new Promise(((s,r)=>{t.passwordValidator(e,(e=>e?r(e):s()))}))},t.usernameField=t.usernameField||"username",t.usernameUnique=void 0===t.usernameUnique||t.usernameUnique,t.usernameQueryFields?t.usernameQueryFields.push(t.usernameField):t.usernameQueryFields=[t.usernameField],t.usernameCaseInsensitive=Boolean(t.usernameCaseInsensitive||!1),t.usernameLowerCase=t.usernameLowerCase||!1,t.hashField=t.hashField||"hash",t.saltField=t.saltField||"salt",t.limitAttempts&&(t.lastLoginField=t.lastLoginField||"last",t.attemptsField=t.attemptsField||"attempts",t.interval=t.interval||100,t.maxInterval=t.maxInterval||3e5,t.maxAttempts=t.maxAttempts||1/0),t.findByUsername=t.findByUsername||function(e,t){return e.findOne(t)},t.errorMessages=t.errorMessages||{},t.errorMessages.MissingPasswordError=t.errorMessages.MissingPasswordError||"No password was given",t.errorMessages.AttemptTooSoonError=t.errorMessages.AttemptTooSoonError||"Account is currently locked. Try again later",t.errorMessages.TooManyAttemptsError=t.errorMessages.TooManyAttemptsError||"Account locked due to too many failed login attempts",t.errorMessages.NoSaltValueStoredError=t.errorMessages.NoSaltValueStoredError||"Authentication not possible. No salt value stored",t.errorMessages.IncorrectPasswordError=t.errorMessages.IncorrectPasswordError||"Password or username is incorrect",t.errorMessages.IncorrectUsernameError=t.errorMessages.IncorrectUsernameError||"Password or username is incorrect",t.errorMessages.MissingUsernameError=t.errorMessages.MissingUsernameError||"No username was given",t.errorMessages.UserExistsError=t.errorMessages.UserExistsError||"A user with the given username is already registered";const s={};e.path(t.usernameField)||(s[t.usernameField]={type:String,unique:t.usernameUnique}),s[t.hashField]={type:String,select:!1},s[t.saltField]={type:String,select:!1},t.limitAttempts&&(s[t.attemptsField]={type:Number,default:0},s[t.lastLoginField]={type:Date,default:Date.now}),e.add(s),e.pre("save",(function(e){t.usernameLowerCase&&this[t.usernameField]&&(this[t.usernameField]=this[t.usernameField].toLowerCase()),e()})),e.methods.setPassword=function(e,s){const n=Promise.resolve().then((()=>{if(!e)throw new o.MissingPasswordError(t.errorMessages.MissingPasswordError)})).then((()=>t.passwordValidatorAsync(e))).then((()=>{return e=t.saltlen,new Promise(((t,s)=>r.randomBytes(e,((e,r)=>e?s(e):t(r)))));var e})).then((e=>e.toString(t.encoding))).then((e=>(this.set(t.saltField,e),e))).then((s=>function(e,t,s){return new Promise(((r,n)=>i(e,t,s,((e,t)=>e?n(e):r(t)))))}(e,s,t))).then((e=>{this.set(t.hashField,Buffer.from(e,"binary").toString(t.encoding))})).then((()=>this));if(!s)return n;n.then((e=>s(null,e))).catch((e=>s(e)))},e.methods.changePassword=function(e,s,r){const n=Promise.resolve().then((()=>{if(!e||!s)throw new o.MissingPasswordError(t.errorMessages.MissingPasswordError)})).then((()=>this.authenticate(e))).then((({user:e,error:t})=>{if(!e)throw t})).then((()=>this.setPassword(s))).then((()=>this.save())).then((()=>this));if(!r)return n;n.then((e=>r(null,e))).catch((e=>r(e)))},e.methods.authenticate=function(e,s){const r=Promise.resolve().then((()=>this.get(t.saltField)?a(this,e,t):this.constructor.findByUsername(this.get(t.usernameField),!0).then((s=>s?a(s,e,t):{user:!1,error:new o.IncorrectUsernameError(t.errorMessages.IncorrectUsernameError)}))));if(!s)return r;r.then((({user:e,error:t})=>s(null,e,t))).catch((e=>s(e)))},t.limitAttempts&&(e.methods.resetAttempts=function(e){const s=Promise.resolve().then((()=>(this.set(t.attemptsField,0),this.save())));if(!e)return s;s.then((t=>e(null,t))).catch((t=>e(t)))}),e.statics.authenticate=function(){return(e,s,r)=>{const n=Promise.resolve().then((()=>this.findByUsername(e,!0))).then((e=>e?e.authenticate(s):{user:!1,error:new o.IncorrectUsernameError(t.errorMessages.IncorrectUsernameError)}));if(!r)return n;n.then((({user:e,error:t})=>r(null,e,t))).catch((e=>r(e)))}},e.statics.serializeUser=function(){return function(e,s){s(null,e.get(t.usernameField))}},e.statics.deserializeUser=function(){return(e,t)=>{this.findByUsername(e,t)}},e.statics.register=function(e,s,r){e instanceof this||(e=new this(e));const n=Promise.resolve().then((()=>{if(!e.get(t.usernameField))throw new o.MissingUsernameError(t.errorMessages.MissingUsernameError)})).then((()=>this.findByUsername(e.get(t.usernameField)))).then((e=>{if(e)throw new o.UserExistsError(t.errorMessages.UserExistsError)})).then((()=>e.setPassword(s))).then((()=>e.save()));if(!r)return n;n.then((e=>r(null,e))).catch((e=>r(e)))},e.statics.findByUsername=function(e,s,r){"function"==typeof s&&(r=s,s={}),"boolean"==typeof s&&(s={selectHashSaltFields:s}),(s=s||{}).selectHashSaltFields=!!s.selectHashSaltFields,void 0!==e&&t.usernameLowerCase&&(e=e.toLowerCase()),void 0!==e&&t.usernameCaseInsensitive&&(e=e.replace(/[!#$()*+\-./:<=>?[\\\]^{|}]/g,"\\$&"));const n=[];for(let s=0;s<t.usernameQueryFields.length;s++){const r={};r[t.usernameQueryFields[s]]=t.usernameCaseInsensitive?new RegExp(`^${e}$`,"i"):e,n.push(r)}const i=t.findByUsername(this,{$or:n});if(s.selectHashSaltFields&&i.select("+"+t.hashField+" +"+t.saltField),t.selectFields&&i.select(t.selectFields),t.populateFields&&i.populate(t.populateFields),!r)return i;i.exec(r)},e.statics.createStrategy=function(){return new n(t,this.authenticate())}},e.exports.errors=o},355:(e,t,s)=>{const r=s(952),n=s(456),i=s(77);function o(e,t,s,o){if(s.limitAttempts){const t=Math.pow(s.interval,Math.log(e.get(s.attemptsField)+1)),r=t<s.maxInterval?t:s.maxInterval;if(Date.now()-e.get(s.lastLoginField)<r)return e.set(s.lastLoginField,Date.now()),void e.save((function(e){return e?o(e):o(null,!1,new i.AttemptTooSoonError(s.errorMessages.AttemptTooSoonError))}));if(e.get(s.attemptsField)>=s.maxAttempts){if(!(s.unlockInterval&&Date.now()-e.get(s.lastLoginField)>s.unlockInterval))return o(null,!1,new i.TooManyAttemptsError(s.errorMessages.TooManyAttemptsError));e.set(s.lastLoginField,Date.now()),e.set(s.attemptsField,0),e.save()}}if(!e.get(s.saltField))return o(null,!1,new i.NoSaltValueStoredError(s.errorMessages.NoSaltValueStoredError));n(t,e.get(s.saltField),s,(function(t,n){if(t)return o(t);if(r(n,Buffer.from(e.get(s.hashField),s.encoding))){if(!s.limitAttempts)return o(null,e);e.set(s.lastLoginField,Date.now()),e.set(s.attemptsField,0),e.save((function(e,t){return e?o(e):o(null,t)}))}else{if(!s.limitAttempts)return o(null,!1,new i.IncorrectPasswordError(s.errorMessages.IncorrectPasswordError));e.set(s.lastLoginField,Date.now()),e.set(s.attemptsField,e.get(s.attemptsField)+1),e.save((function(t){return t?o(t):e.get(s.attemptsField)>=s.maxAttempts?o(null,!1,new i.TooManyAttemptsError(s.errorMessages.TooManyAttemptsError)):o(null,!1,new i.IncorrectPasswordError(s.errorMessages.IncorrectPasswordError))}))}}))}e.exports=function(e,t,s,r){return r?o(e,t,s,r):new Promise(((r,n)=>{o(e,t,s,((e,t,s)=>e?n(e):r({user:t,error:s})))}))}},77:(e,t,s)=>{const r=s(791),n=r("AuthenticationError");e.exports={AuthenticationError:n,IncorrectUsernameError:r("IncorrectUsernameError",null,{inherits:n}),IncorrectPasswordError:r("IncorrectPasswordError",null,{inherits:n}),MissingUsernameError:r("MissingUsernameError",null,{inherits:n}),MissingPasswordError:r("MissingPasswordError",null,{inherits:n}),UserExistsError:r("UserExistsError",null,{inherits:n}),NoSaltValueStoredError:r("NoSaltValueStoredError",null,{inherits:n}),AttemptTooSoonError:r("AttemptTooSoonError",null,{inherits:n}),TooManyAttemptsError:r("TooManyAttemptsError",null,{inherits:n})}},456:(e,t,s)=>{const r=s(113);e.exports=function(e,t,s,n){r.pbkdf2(e,t,s.iterations,s.keylen,s.digestAlgorithm,n)}},462:(e,t,s)=>{var r=s(885);(e.exports=r).Strategy=r},885:(e,t,s)=>{var r=s(251),n=s(837),i=s(469).P;function o(e,t){if("function"==typeof e&&(t=e,e={}),!t)throw new TypeError("LocalStrategy requires a verify callback");this._usernameField=e.usernameField||"username",this._passwordField=e.passwordField||"password",r.Strategy.call(this),this.name="local",this._verify=t,this._passReqToCallback=e.passReqToCallback}n.inherits(o,r.Strategy),o.prototype.authenticate=function(e,t){t=t||{};var s=i(e.body,this._usernameField)||i(e.query,this._usernameField),r=i(e.body,this._passwordField)||i(e.query,this._passwordField);if(!s||!r)return this.fail({message:t.badRequestMessage||"Missing credentials"},400);var n=this;function o(e,t,s){return e?n.error(e):t?void n.success(t,s):n.fail(s)}try{n._passReqToCallback?this._verify(e,s,r,o):this._verify(s,r,o)}catch(e){return n.error(e)}},e.exports=o},469:(e,t)=>{t.P=function(e,t){if(!e)return null;for(var s=t.split("]").join("").split("["),r=0,n=s.length;r<n;r++){var i=e[s[r]];if(void 0===i)return null;if("object"!=typeof i)return i;e=i}return null}},251:(e,t,s)=>{var r=s(544);(e.exports=r).Strategy=r},544:e=>{function t(){}t.prototype.authenticate=function(e,t){throw new Error("Strategy#authenticate must be overridden by subclass")},e.exports=t},451:(e,t,s)=>{var r=s(728),n=s(129);function i(){this._key="passport",this._strategies={},this._serializers=[],this._deserializers=[],this._infoTransformers=[],this._framework=null,this.init()}i.prototype.init=function(){this.framework(s(240)()),this.use(new r({key:this._key},this.deserializeUser.bind(this))),this._sm=new n({key:this._key},this.serializeUser.bind(this))},i.prototype.use=function(e,t){if(t||(e=(t=e).name),!e)throw new Error("Authentication strategies must have a name");return this._strategies[e]=t,this},i.prototype.unuse=function(e){return delete this._strategies[e],this},i.prototype.framework=function(e){return this._framework=e,this},i.prototype.initialize=function(e){return e=e||{},this._framework.initialize(this,e)},i.prototype.authenticate=function(e,t,s){return this._framework.authenticate(this,e,t,s)},i.prototype.authorize=function(e,t,s){return(t=t||{}).assignProperty="account",(this._framework.authorize||this._framework.authenticate)(this,e,t,s)},i.prototype.session=function(e){return this.authenticate("session",e)},i.prototype.serializeUser=function(e,t,s){if("function"==typeof e)return this._serializers.push(e);var r=e;"function"==typeof t&&(s=t,t=void 0);var n=this._serializers;!function e(i,o,a){if("pass"===o&&(o=void 0),o||a||0===a)return s(o,a);var u=n[i];if(!u)return s(new Error("Failed to serialize user into session"));function c(t,s){e(i+1,t,s)}try{3==u.length?u(t,r,c):u(r,c)}catch(e){return s(e)}}(0)},i.prototype.deserializeUser=function(e,t,s){if("function"==typeof e)return this._deserializers.push(e);var r=e;"function"==typeof t&&(s=t,t=void 0);var n=this._deserializers;!function e(i,o,a){if("pass"===o&&(o=void 0),o||a)return s(o,a);if(null===a||!1===a)return s(null,!1);var u=n[i];if(!u)return s(new Error("Failed to deserialize user out of session"));function c(t,s){e(i+1,t,s)}try{3==u.length?u(t,r,c):u(r,c)}catch(e){return s(e)}}(0)},i.prototype.transformAuthInfo=function(e,t,s){if("function"==typeof e)return this._infoTransformers.push(e);var r=e;"function"==typeof t&&(s=t,t=void 0);var n=this._infoTransformers;!function e(i,o,a){if("pass"===o&&(o=void 0),o||a)return s(o,a);var u=n[i];if(!u)return s(null,r);function c(t,s){e(i+1,t,s)}try{var l=u.length;1==l?c(null,u(r)):3==l?u(t,r,c):u(r,c)}catch(e){return s(e)}}(0)},i.prototype._strategy=function(e){return this._strategies[e]},e.exports=i},313:e=>{function t(e,t){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.name="AuthenticationError",this.message=e,this.status=t||401}t.prototype.__proto__=Error.prototype,e.exports=t},240:(e,t,s)=>{var r=s(904),n=s(25);e.exports=function(){return{initialize:r,authenticate:n}}},443:(e,t)=>{var s=e.exports={};s.login=s.logIn=function(e,t,s){"function"==typeof t&&(s=t,t={}),t=t||{};var r=this._userProperty||"user",n=void 0===t.session||t.session;if(this[r]=e,n&&this._sessionManager){if("function"!=typeof s)throw new Error("req#login requires a callback function");var i=this;this._sessionManager.logIn(this,e,t,(function(e){if(e)return i[r]=null,s(e);s()}))}else s&&s()},s.logout=s.logOut=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},this[this._userProperty||"user"]=null,this._sessionManager){if("function"!=typeof t)throw new Error("req#logout requires a callback function");this._sessionManager.logOut(this,e,t)}else t&&t()},s.isAuthenticated=function(){return!!this[this._userProperty||"user"]},s.isUnauthenticated=function(){return!this.isAuthenticated()}},212:(e,t,s)=>{var r=s(451),n=s(728);(t=e.exports=new r).Passport=t.Authenticator=r,t.Strategy=s(251),t.strategies={},t.strategies.SessionStrategy=n},25:(e,t,s)=>{var r=s(685),n=s(443),i=s(313);e.exports=function(e,t,s,o){"function"==typeof s&&(o=s,s={}),s=s||{};var a=!0;return Array.isArray(t)||(t=[t],a=!1),function(u,c,l){u.login=u.logIn=u.logIn||n.logIn,u.logout=u.logOut=u.logOut||n.logOut,u.isAuthenticated=u.isAuthenticated||n.isAuthenticated,u.isUnauthenticated=u.isUnauthenticated||n.isUnauthenticated,u._sessionManager=e._sm;var f=[];!function n(p){var h,d,g=t[p];if(!g)return function(){if(o){if(a){var e=f.map((function(e){return e.challenge})),t=f.map((function(e){return e.status}));return o(null,!1,e,t)}return o(null,!1,f[0].challenge,f[0].status)}var n,p=f[0]||{},h=p.challenge||{};if(s.failureFlash){var d=s.failureFlash;"string"==typeof d&&(d={type:"error",message:d}),d.type=d.type||"error";var g=d.type||h.type||"error";"string"==typeof(n=d.message||h.message||h)&&u.flash(g,n)}if(s.failureMessage&&("boolean"==typeof(n=s.failureMessage)&&(n=h.message||h),"string"==typeof n&&(u.session.messages=u.session.messages||[],u.session.messages.push(n))),s.failureRedirect)return c.redirect(s.failureRedirect);for(var m,y,v=[],w=0,x=f.length;w<x;w++)h=(p=f[w]).challenge,y=p.status,m=m||y,"string"==typeof h&&v.push(h);if(c.statusCode=m||401,401==c.statusCode&&v.length&&c.setHeader("WWW-Authenticate",v),s.failWithError)return l(new i(r.STATUS_CODES[c.statusCode],m));c.end(r.STATUS_CODES[c.statusCode])}();if("function"==typeof g.authenticate)h=g;else{if(!(d=e._strategy(g)))return l(new Error('Unknown authentication strategy "'+g+'"'));h=Object.create(d)}h.success=function(t,r){if(o)return o(null,t,r);var n;if(r=r||{},s.successFlash){var i=s.successFlash;"string"==typeof i&&(i={type:"success",message:i}),i.type=i.type||"success";var a=i.type||r.type||"success";"string"==typeof(n=i.message||r.message||r)&&u.flash(a,n)}if(s.successMessage&&("boolean"==typeof(n=s.successMessage)&&(n=r.message||r),"string"==typeof n&&(u.session.messages=u.session.messages||[],u.session.messages.push(n))),s.assignProperty)return u[s.assignProperty]=t,l();u.logIn(t,s,(function(t){if(t)return l(t);function n(){if(s.successReturnToOrRedirect){var e=s.successReturnToOrRedirect;return u.session&&u.session.returnTo&&(e=u.session.returnTo,delete u.session.returnTo),c.redirect(e)}if(s.successRedirect)return c.redirect(s.successRedirect);l()}!1!==s.authInfo?e.transformAuthInfo(r,u,(function(e,t){if(e)return l(e);u.authInfo=t,n()})):n()}))},h.fail=function(e,t){"number"==typeof e&&(t=e,e=void 0),f.push({challenge:e,status:t}),n(p+1)},h.redirect=function(e,t){c.statusCode=t||302,c.setHeader("Location",e),c.setHeader("Content-Length","0"),c.end()},h.pass=function(){l()},h.error=function(e){if(o)return o(e);l(e)},h.authenticate(u,s)}(0)}}},904:(e,t,s)=>{var r=s(443);e.exports=function(e,t){return t=t||{},function(s,n,i){s.login=s.logIn=s.logIn||r.logIn,s.logout=s.logOut=s.logOut||r.logOut,s.isAuthenticated=s.isAuthenticated||r.isAuthenticated,s.isUnauthenticated=s.isUnauthenticated||r.isUnauthenticated,s._sessionManager=e._sm,t.userProperty&&(s._userProperty=t.userProperty),(void 0===t.compat||t.compat)&&(e._userProperty=t.userProperty||"user",s._passport={},s._passport.instance=e),i()}}},129:(e,t,s)=>{var r=s(588);function n(e,t){"function"==typeof e&&(t=e,e=void 0),e=e||{},this._key=e.key||"passport",this._serializeUser=t}n.prototype.logIn=function(e,t,s,n){if("function"==typeof s&&(n=s,s={}),s=s||{},!e.session)return n(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));var i=this,o=e.session;e.session.regenerate((function(a){if(a)return n(a);i._serializeUser(t,e,(function(t,a){if(t)return n(t);s.keepSessionInfo&&r(e.session,o),e.session[i._key]||(e.session[i._key]={}),e.session[i._key].user=a,e.session.save((function(e){if(e)return n(e);n()}))}))}))},n.prototype.logOut=function(e,t,s){if("function"==typeof t&&(s=t,t={}),t=t||{},!e.session)return s(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));e.session[this._key]&&delete e.session[this._key].user;var n=e.session;e.session.save((function(i){if(i)return s(i);e.session.regenerate((function(i){if(i)return s(i);t.keepSessionInfo&&r(e.session,n),s()}))}))},e.exports=n},728:(e,t,s)=>{var r=s(951),n=s(837),i=s(251);function o(e,t){"function"==typeof e&&(t=e,e=void 0),e=e||{},i.call(this),this.name="session",this._key=e.key||"passport",this._deserializeUser=t}n.inherits(o,i),o.prototype.authenticate=function(e,t){if(!e.session)return this.error(new Error("Login sessions require session support. Did you forget to use `express-session` middleware?"));t=t||{};var s,n=this;if(e.session[this._key]&&(s=e.session[this._key].user),s||0===s){var i=t.pauseStream?r(e):null;this._deserializeUser(s,e,(function(t,s){if(t)return n.error(t);if(s){var r=e._userProperty||"user";e[r]=s}else delete e.session[n._key].user;n.pass(),i&&i.resume()}))}else n.pass()},e.exports=o},951:e=>{e.exports=function(e){var t,s,r=[];return e.on("data",t=function(e,t){r.push(["data",e,t])}),e.on("end",s=function(e,t){r.push(["end",e,t])}),{end:function(){e.removeListener("data",t),e.removeListener("end",s)},resume:function(){this.end();for(var t=0,s=r.length;t<s;++t)e.emit.apply(e,r[t])}}}},793:(e,t,s)=>{"use strict";var r=s(113),n=r.randomBytes===r.pseudoRandomBytes?1:3;function i(e,t,s){r.randomBytes(e,(function(r,n){return r?--t?void setTimeout(i.bind(null,e,t,s),10):s(r):s(null,n)}))}e.exports=function(e,t){if(void 0!==t&&"function"!=typeof t)throw new TypeError("argument callback must be a function");if(!t&&!global.Promise)throw new TypeError("argument callback is required");return t?i(e,n,t):new Promise((function(t,s){i(e,n,(function(e,r){if(e)return s(e);t(r)}))}))},e.exports.sync=function(e){for(var t=null,s=0;s<n;s++)try{return r.randomBytes(e)}catch(e){t=e}throw t}},952:(e,t,s)=>{"use strict";const r=s(113),n=s(645);e.exports=function(e,t){if(!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new Error("Both scmp args must be Buffers");return e.length===t.length&&(r.timingSafeEqual?r.timingSafeEqual(e,t):n(e,t))}},645:e=>{"use strict";e.exports=function(e,t){const s=e.length;let r=0;for(let n=0;n<s;++n)r|=e[n]^t[n];return 0===r}},599:(e,t,s)=>{"use strict";var r=s(793),n=/=+$/,i=/\+/g,o=/\//g;function a(e,t){r(e,(function(e,s){if(e)return t(e);t(null,u(s))}))}function u(e){return e.toString("base64").replace(n,"").replace(i,"-").replace(o,"_")}e.exports=function(e,t){if(void 0!==t&&"function"!=typeof t)throw new TypeError("argument callback must be a function");if(!t&&!global.Promise)throw new TypeError("argument callback is required");return t?a(e,t):new Promise((function(t,s){a(e,(function(e,r){if(e)return s(e);t(r)}))}))},e.exports.sync=function(e){return u(r.sync(e))}},518:e=>{"use strict";e.exports=require("cloudinary")},802:e=>{"use strict";e.exports=require("cookie")},553:e=>{"use strict";e.exports=require("cookie-signature")},974:e=>{"use strict";e.exports=require("debug")},352:e=>{"use strict";e.exports=require("depd")},142:e=>{"use strict";e.exports=require("dotenv")},239:e=>{"use strict";e.exports=require("events")},860:e=>{"use strict";e.exports=require("express")},185:e=>{"use strict";e.exports=require("mongoose")},738:e=>{"use strict";e.exports=require("multer")},215:e=>{"use strict";e.exports=require("parseurl")},400:e=>{"use strict";e.exports=require("safe-buffer")},588:e=>{"use strict";e.exports=require("utils-merge")},113:e=>{"use strict";e.exports=require("crypto")},685:e=>{"use strict";e.exports=require("http")},837:e=>{"use strict";e.exports=require("util")}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,s),i.exports}(()=>{const e=s(860);s(427),s(945);const{authRouter:t,postRouter:r}=s(532),n=s(212),i=s(24),o=s(294),a=e();a.use(i({secret:process.env.SECRET,resave:!1,saveUninitialized:!1})),a.use(n.initialize()),a.use(n.session()),a.use(e.json()),a.set("view engine","ejs"),a.set("views","./src/views"),a.use(e.static("public")),a.use(e.urlencoded({extended:!0})),a.use(r,t),a.use(o),a.listen(3e3)})()})();