<<<<<<< HEAD
(()=>{var e={427:(e,s,t)=>{t(185).connect(process.env.MONGODB_URL)},294:e=>{e.exports=(e,s,t,r)=>{console.error(e),t.status(500).send(e)}},954:(e,s,t)=>{const r=t(738),o=r.diskStorage({}),a=r({storage:o,fileFilter:(e,s,t)=>{"image/jpeg"===s.mimetype||"image/png"===s.mimetype?t(null,!0):t({message:"Invalid file type."},!1)}});e.exports=a},256:(e,s,t)=>{const r=t(185),o=new r.Schema({name:String,allTags:[String]},{timestamps:!0}),a=r.model("Category",o);e.exports=a},998:(e,s,t)=>{const r=t(185),o=new r.Schema({imageUrl:String,publicId:String},{timestamps:!0}),a=r.model("Image",o);e.exports={Image:a,imageSchema:o}},3:(e,s,t)=>{const r=t(185),{imageSchema:o}=t(998),a=new r.Schema({title:String,subtitle:String,content:String,images:[o],postTags:[String]},{timestamps:!0}),i=r.model("Post",a);e.exports=i},945:(e,s,t)=>{const r=t(185),o=t(270),a=t(511),i=new r.Schema({username:String,password:String},{timestamps:!0});i.plugin(o);const n=r.model("User",i);a.use(n.createStrategy()),a.serializeUser(n.serializeUser()),a.deserializeUser(n.deserializeUser()),e.exports=n},119:(e,s,t)=>{const r=t(860),o=t(511),a=new r.Router;a.get("/login",((e,s)=>{s.render("login")})),a.post("/login",o.authenticate("local",{successRedirect:"/admin/dashboard",failureRedirect:"/login"})),a.get("/logout",((e,s,t)=>{e.session.user=null,e.session.save((r=>{r&&t(r),e.session.regenerate((e=>{e&&t(e),s.redirect("/")}))}))})),a.get("/admin/dashboard",((e,s)=>{s.set("Cache-Control","no-cache, private, no-store, must-revalidate, max-stal e=0, post-check=0, pre-check=0"),e.isAuthenticated()?s.render("dashboard"):s.redirect("/login")})),e.exports=a},437:(e,s,t)=>{const r=t(860),o=t(256),a=new r.Router;a.get("/rawCategories",(async(e,s)=>{try{const e=await o.find();s.status(200).json(e)}catch(e){s.status(404).json({message:e.message})}})),a.post("/categories",(async(e,s)=>{try{const s=new o(e.body);await s.save()}catch(e){s.status(400).send(e)}})),e.exports=a},762:(e,s,t)=>{const r=t(860),o=t(954),a=t(3),{Image:i}=t(998),{uploadToCloudinary:n,removeFromCloudinary:c}=t(463),u=new r.Router,p=(t(738),o.array("images",20));u.get("/",(async(e,s)=>{s.redirect("posts")})),u.get("/posts",(async(e,s)=>{try{const e=await a.find();s.status(200).json(e)}catch(e){s.status(404).send(e)}})),u.post("/posts",p,(async(e,s)=>{try{const t=new a(e.body),r=await t.save(),o=e.files;await Promise.all(o.map((async e=>{const s=await n(e.path,"emaJons_dev"),t=new i({publicId:s.public_id,imageUrl:s.url});await a.updateOne({_id:r._id},{$addToSet:{images:[t]}})}))),s.redirect("/grid")}catch(e){s.status(400).send(e)}})),e.exports=u},532:(e,s,t)=>{const r=t(119),o=t(762),a=t(437);e.exports={authRouter:r,postRouter:o,categoryRouter:a}},463:(e,s,t)=>{const r=t(518);t(142).config(),r.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET}),e.exports={uploadToCloudinary:(e,s)=>r.v2.uploader.upload(e,{folder:s}).then((e=>({url:e.url,public_id:e.public_id}))).catch((e=>{console.log(e)})),removeFromCloudinary:async e=>{await r.v2.uploader.destroy(e,((e,s)=>{console.log(e,s)}))}}},518:e=>{"use strict";e.exports=require("cloudinary")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},508:e=>{"use strict";e.exports=require("express-session")},185:e=>{"use strict";e.exports=require("mongoose")},738:e=>{"use strict";e.exports=require("multer")},511:e=>{"use strict";e.exports=require("passport")},270:e=>{"use strict";e.exports=require("passport-local-mongoose")},17:e=>{"use strict";e.exports=require("path")}},s={};function t(r){var o=s[r];if(void 0!==o)return o.exports;var a=s[r]={exports:{}};return e[r](a,a.exports,t),a.exports}(()=>{const e=t(860);t(427),t(945);const{authRouter:s,postRouter:r,categoryRouter:o}=t(532),a=t(511),i=t(508),n=t(294),c=t(17),u=e();u.use(i({secret:process.env.SECRET,resave:!1,saveUninitialized:!1})),u.use(a.initialize()),u.use(a.session()),u.use(e.json()),u.set("view engine","ejs"),u.set("views","./src/views"),u.use(e.static("public")),u.use(e.urlencoded({extended:!0})),u.use(r,s,o),u.use(n),u.use("/assets",e.static(c.join(__dirname,"../public"))),u.get("/*",((e,s)=>{try{s.render("home")}catch(e){s.status(400).send(e)}})),u.listen(3e3)})()})();
=======
(()=>{var e={427:(e,s,t)=>{t(185).connect(process.env.MONGODB_URL)},294:e=>{e.exports=(e,s,t,r)=>{console.error(e),t.status(500).send(e)}},954:(e,s,t)=>{const r=t(738),o=r.diskStorage({}),a=r({storage:o,fileFilter:(e,s,t)=>{"image/jpeg"===s.mimetype||"image/png"===s.mimetype?t(null,!0):t({message:"Invalid file type."},!1)}});e.exports=a},256:(e,s,t)=>{const r=t(185),o=new r.Schema({name:String,allTags:[]},{timestamps:!0}),a=r.model("Category",o);e.exports=a},998:(e,s,t)=>{const r=t(185),o=new r.Schema({imageUrl:String,publicId:String},{timestamps:!0}),a=r.model("Image",o);e.exports={Image:a,imageSchema:o}},3:(e,s,t)=>{const r=t(185),{imageSchema:o}=t(998),a=new r.Schema({title:String,subtitle:String,content:String,images:[o],postTags:[],category:String},{timestamps:!0}),i=r.model("Post",a);e.exports=i},945:(e,s,t)=>{const r=t(185),o=t(270),a=t(511),i=new r.Schema({username:String,password:String},{timestamps:!0});i.plugin(o);const n=r.model("User",i);a.use(n.createStrategy()),a.serializeUser(n.serializeUser()),a.deserializeUser(n.deserializeUser()),e.exports=n},119:(e,s,t)=>{const r=t(860),o=t(511),a=new r.Router;a.get("/login",((e,s)=>{s.render("login")})),a.post("/login",o.authenticate("local",{successRedirect:"/admin/dashboard",failureRedirect:"/login"})),a.get("/logout",((e,s,t)=>{e.session.user=null,e.session.save((r=>{r&&t(r),e.session.regenerate((e=>{e&&t(e),s.redirect("/")}))}))})),a.get("/admin/dashboard",((e,s)=>{s.set("Cache-Control","no-cache, private, no-store, must-revalidate, max-stal e=0, post-check=0, pre-check=0"),e.isAuthenticated()?s.render("dashboard"):s.redirect("/login")})),e.exports=a},437:(e,s,t)=>{const r=t(860),o=t(256),a=new r.Router,i=t(517);a.get("/api/categories/:category",(async(e,s)=>{try{const t=await o.find({name:i.capitalize(e.params.category)});s.json(t)}catch(e){s.status(400).send(e)}})),e.exports=a},762:(e,s,t)=>{const r=t(860),o=t(954),a=t(3),{Image:i}=t(998),{uploadToCloudinary:n,removeFromCloudinary:c}=t(463),u=t(517),p=new r.Router,d=(t(738),o.array("images",20));p.get("/",(async(e,s)=>{s.redirect("/admin/dashboard")})),p.get("/api/posts/:category",(async(e,s)=>{try{const t=await a.find({category:u.capitalize(e.params.category)});s.json(t)}catch(e){s.status(400).send(e)}})),p.get("/api/posts/:category/:postId",(async(e,s)=>{try{const t=await a.findById(e.params.postId);s.json(t)}catch(e){s.status(400).send(e)}})),p.post("/posts",d,(async(e,s)=>{try{const t=new a(e.body),r=await t.save(),o=e.files;await Promise.all(o.map((async e=>{const s=await n(e.path,"emaJons_dev"),t=new i({publicId:s.public_id,imageUrl:s.url});await a.updateOne({_id:r._id},{$addToSet:{images:[t]}})}))),s.status(200).json({lastId:t._id})}catch(e){s.status(400).send(e)}})),e.exports=p},532:(e,s,t)=>{const r=t(119),o=t(762),a=t(437);e.exports={authRouter:r,postRouter:o,categoryRouter:a}},463:(e,s,t)=>{const r=t(518);t(142).config(),r.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET}),e.exports={uploadToCloudinary:(e,s)=>r.v2.uploader.upload(e,{folder:s}).then((e=>({url:e.url,public_id:e.public_id}))).catch((e=>{console.log(e)})),removeFromCloudinary:async e=>{await r.v2.uploader.destroy(e,((e,s)=>{console.log(e,s)}))}}},518:e=>{"use strict";e.exports=require("cloudinary")},582:e=>{"use strict";e.exports=require("cors")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},508:e=>{"use strict";e.exports=require("express-session")},517:e=>{"use strict";e.exports=require("lodash")},185:e=>{"use strict";e.exports=require("mongoose")},738:e=>{"use strict";e.exports=require("multer")},511:e=>{"use strict";e.exports=require("passport")},270:e=>{"use strict";e.exports=require("passport-local-mongoose")},17:e=>{"use strict";e.exports=require("path")}},s={};function t(r){var o=s[r];if(void 0!==o)return o.exports;var a=s[r]={exports:{}};return e[r](a,a.exports,t),a.exports}(()=>{const e=t(860);t(427),t(945);const{authRouter:s,postRouter:r,categoryRouter:o}=t(532),a=t(511),i=t(508),n=t(294),c=t(17),u=t(582),p=e();p.use(u()),p.use(i({secret:process.env.SECRET,resave:!1,saveUninitialized:!1})),p.use(a.initialize()),p.use(a.session()),p.use(e.json()),p.set("view engine","ejs"),p.set("views","./src/views"),p.use(e.static("public")),p.use(e.urlencoded({extended:!0})),p.use(r,s,o),p.use(n),p.use("/assets",e.static(c.join(__dirname,"../public"))),p.get("/*",((e,s)=>{try{s.render("home")}catch(e){s.status(400).send(e)}})),p.listen(3e3)})()})();
>>>>>>> 033662da6f8264e8245e53cc6a10269b4f4d6d9a
