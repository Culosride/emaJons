(()=>{var e={427:(e,s,t)=>{t(185).connect(process.env.MONGODB_URL)},294:e=>{e.exports=(e,s,t,r)=>{console.error(e),t.status(500).send(e)}},954:(e,s,t)=>{const r=t(738),o=r.diskStorage({}),n=r({storage:o,fileFilter:(e,s,t)=>{"image/jpeg"===s.mimetype||"image/png"===s.mimetype?t(null,!0):t({message:"Invalid file type."},!1)}});e.exports=n},256:(e,s,t)=>{const r=t(185),o=new r.Schema({name:String,allTags:[]},{timestamps:!0}),n=r.model("Category",o);e.exports=n},998:(e,s,t)=>{const r=t(185),o=new r.Schema({imageUrl:String,publicId:String},{timestamps:!0}),n=r.model("Image",o);e.exports={Image:n,imageSchema:o}},3:(e,s,t)=>{const r=t(185),{imageSchema:o}=t(998),n=new r.Schema({title:String,subtitle:String,content:String,images:[o],postTags:[],category:String},{timestamps:!0}),i=r.model("Post",n);e.exports=i},945:(e,s,t)=>{const r=t(185),o=t(270),n=t(511),i=new r.Schema({username:String,password:String},{timestamps:!0});i.plugin(o);const a=r.model("User",i);n.use(a.createStrategy()),n.serializeUser(a.serializeUser()),n.deserializeUser(a.deserializeUser()),e.exports=a},119:(e,s,t)=>{const r=t(860),o=t(511),n=new r.Router;n.get("/login",((e,s)=>{s.render("login")})),n.post("/login",o.authenticate("local",{successRedirect:"/admin/dashboard",failureRedirect:"/login"})),n.get("/logout",((e,s,t)=>{e.session.user=null,e.session.save((r=>{r&&t(r),e.session.regenerate((e=>{e&&t(e),s.redirect("/")}))}))})),n.get("/admin/dashboard",((e,s)=>{s.set("Cache-Control","no-cache, private, no-store, must-revalidate, max-stal e=0, post-check=0, pre-check=0"),e.isAuthenticated()?s.render("dashboard"):s.redirect("/login")})),e.exports=n},437:(e,s,t)=>{const r=t(860),o=t(256),n=new r.Router,i=t(517);n.get("/api/categories/:category",(async(e,s)=>{try{const t=await o.find({name:i.capitalize(e.params.category)});s.json(t)}catch(e){s.status(400).send(e)}})),e.exports=n},762:(e,s,t)=>{const r=t(860),o=t(954),n=t(3),{Image:i}=t(998),{uploadToCloudinary:a,removeFromCloudinary:u}=t(463),c=t(517),l=new r.Router,p=(t(738),o.array("images",20));l.get("/",(async(e,s)=>{s.redirect("/admin/dashboard")})),l.get("/api/posts/:category",(async(e,s)=>{try{const t=await n.find({category:c.capitalize(e.params.category)});s.json(t)}catch(e){s.status(400).send(e)}})),l.get("/api/posts/:category/:postId",(async(e,s)=>{try{const t=await n.findById(e.params.postId);s.json(t)}catch(e){s.status(400).send(e)}})),l.post("/posts",p,(async(e,s)=>{try{const t=new n(e.body),r=await t.save(),o=e.files;await Promise.all(o.map((async e=>{const s=await a(e.path,"emaJons_dev"),t=new i({publicId:s.public_id,imageUrl:s.url});await n.updateOne({_id:r._id},{$addToSet:{images:[t]}})}))),s.status(200).json({lastId:t._id})}catch(e){s.status(400).send(e)}})),e.exports=l},532:(e,s,t)=>{const r=t(119),o=t(762),n=t(437);e.exports={authRouter:r,postRouter:o,categoryRouter:n}},463:(e,s,t)=>{const r=t(518);t(142).config(),r.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET}),e.exports={uploadToCloudinary:(e,s)=>r.v2.uploader.upload(e,{folder:s}).then((e=>({url:e.url,public_id:e.public_id}))).catch((e=>{console.log(e)})),removeFromCloudinary:async e=>{await r.v2.uploader.destroy(e,((e,s)=>{console.log(e,s)}))}}},846:(e,s,t)=>{!function(){"use strict";var s=t(965),r=t(561),o={origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",preflightContinue:!1,optionsSuccessStatus:204};function n(e){return"string"==typeof e||e instanceof String}function i(e,s){if(Array.isArray(s)){for(var t=0;t<s.length;++t)if(i(e,s[t]))return!0;return!1}return n(s)?e===s:s instanceof RegExp?s.test(e):!!s}function a(e,s){var t,r=s.headers.origin,o=[];return e.origin&&"*"!==e.origin?n(e.origin)?(o.push([{key:"Access-Control-Allow-Origin",value:e.origin}]),o.push([{key:"Vary",value:"Origin"}])):(t=i(r,e.origin),o.push([{key:"Access-Control-Allow-Origin",value:!!t&&r}]),o.push([{key:"Vary",value:"Origin"}])):o.push([{key:"Access-Control-Allow-Origin",value:"*"}]),o}function u(e){return!0===e.credentials?{key:"Access-Control-Allow-Credentials",value:"true"}:null}function c(e){var s=e.exposedHeaders;return s?(s.join&&(s=s.join(",")),s&&s.length?{key:"Access-Control-Expose-Headers",value:s}:null):null}function l(e,s){for(var t=0,o=e.length;t<o;t++){var n=e[t];n&&(Array.isArray(n)?l(n,s):"Vary"===n.key&&n.value?r(s,n.value):n.value&&s.setHeader(n.key,n.value))}}e.exports=function(e){var t=null;return t="function"==typeof e?e:function(s,t){t(null,e)},function(e,r,n){t(e,(function(t,i){if(t)n(t);else{var p=s({},o,i),d=null;p.origin&&"function"==typeof p.origin?d=p.origin:p.origin&&(d=function(e,s){s(null,p.origin)}),d?d(e.headers.origin,(function(s,t){s||!t?n(s):(p.origin=t,function(e,s,t,r){var o=[];"OPTIONS"===(s.method&&s.method.toUpperCase&&s.method.toUpperCase())?(o.push(a(e,s)),o.push(u(e)),o.push(function(e){var s=e.methods;return s.join&&(s=e.methods.join(",")),{key:"Access-Control-Allow-Methods",value:s}}(e)),o.push(function(e,s){var t=e.allowedHeaders||e.headers,r=[];return t?t.join&&(t=t.join(",")):(t=s.headers["access-control-request-headers"],r.push([{key:"Vary",value:"Access-Control-Request-Headers"}])),t&&t.length&&r.push([{key:"Access-Control-Allow-Headers",value:t}]),r}(e,s)),o.push(function(e){var s=("number"==typeof e.maxAge||e.maxAge)&&e.maxAge.toString();return s&&s.length?{key:"Access-Control-Max-Age",value:s}:null}(e)),o.push(c(e)),l(o,t),e.preflightContinue?r():(t.statusCode=e.optionsSuccessStatus,t.setHeader("Content-Length","0"),t.end())):(o.push(a(e,s)),o.push(u(e)),o.push(c(e)),l(o,t),r())}(p,e,r,n))})):n()}}))}}}()},518:e=>{"use strict";e.exports=require("cloudinary")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},508:e=>{"use strict";e.exports=require("express-session")},517:e=>{"use strict";e.exports=require("lodash")},185:e=>{"use strict";e.exports=require("mongoose")},738:e=>{"use strict";e.exports=require("multer")},965:e=>{"use strict";e.exports=require("object-assign")},511:e=>{"use strict";e.exports=require("passport")},270:e=>{"use strict";e.exports=require("passport-local-mongoose")},561:e=>{"use strict";e.exports=require("vary")},17:e=>{"use strict";e.exports=require("path")}},s={};function t(r){var o=s[r];if(void 0!==o)return o.exports;var n=s[r]={exports:{}};return e[r](n,n.exports,t),n.exports}(()=>{const e=t(860);t(427),t(945);const{authRouter:s,postRouter:r,categoryRouter:o}=t(532),n=t(511),i=t(508),a=t(294),u=t(17),c=t(846),l=e();l.use(c()),l.use(i({secret:process.env.SECRET,resave:!1,saveUninitialized:!1})),l.use(n.initialize()),l.use(n.session()),l.use(e.json()),l.set("view engine","ejs"),l.set("views","./src/views"),l.use(e.static("public")),l.use(e.urlencoded({extended:!0})),l.use(r,s,o),l.use(a),l.use("/assets",e.static(u.join(__dirname,"../public"))),l.get("/*",((e,s)=>{try{s.render("home")}catch(e){s.status(400).send(e)}})),l.listen(3e3)})()})();